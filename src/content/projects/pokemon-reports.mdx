---
title: "Reportes Pokemon V2"
description: "Evoluci√≥n de App Generador de Reportes V1 desplegado en la Nube"

title_en: "Pokemon Reports V2"
description_en: "Reports Generator V1 Improvemets"



icon: "üìÑ"
---

# Descripci√≥n

Este proyecto, PokeQueue, es una aplicaci√≥n basada en FastAPI dise√±ada para gestionar solicitudes de generaci√≥n de listas de Pok√©mon seg√∫n su tipo, esto se plasma en la generaci√≥n de un archivo CSV, en el interfaz de usuario se tiene una tabla de registros, un select para obtener y seleccionar el tipo de pok√©mon deseado, un campo input para indicar el n√∫mero de pok√©mon que deseamos en nuestra lista, y el bot√≥n "Catch them all" para crear la solicitud hacia que llega al Backend en el servidor que se comunica con la base de datos y el Queue Storage y el Worker. 


Su prop√≥sito es gestionar datos y flujos de procesamiento relacionados con Pok√©mon en un entorno escalable basado en la nube.

# Arquitectura

La arquitectura se integra con servicios de Azure, incluyendo Azure Container Registry para almacenar las imagenes generadas por Docker de la Ui y la API, Azure SQL Database para almacenamiento de datos, el App Service Plan que contiene las Function Apps de la Ui, la API y el Worker y Azure Storage Account que contiene el  Queue Storage para la gesti√≥n de colas de mensajes y el Blob Storage que maneja la creaci√≥n de los archivos CSV.

## Tecnolog√≠as Clave

- Front-End : Next.js con JavaScript
- Back-End : FastAPI con Python
- Base de Datos : Azure SQL con SQL Server
- Infraestructura : Terraform
- Azure : ACR, APP Service Plan, Storage Account, Azure SQL

# V2 Features

## Eliminar Registros : 
- Frontend (Next.js):
  - Se A√±adio un bot√≥n de "Eliminar" a cada fila de la tabla de reportes.
  - se Implemento un dialog de confirmaci√≥n antes de proceder con la eliminaci√≥n.
  - Al confirmar, realiza una llamada a la API backend para solicitar la eliminaci√≥n.
  - Actualiza la lista de reportes en la UI despu√©s de una eliminaci√≥n exitosa.
- Backend (API FastAPI):
  - Se Creo un nuevo endpoint en la API e Implementa la l√≥gica para: 
‚ñ† Verificar que el reporte existe en Azure SQL DB. 
‚ñ† Eliminar el archivo CSV correspondiente del contenedor en Azure Blob

## Enriqucer Reporte :
Se a√±adio  las estad√≠sticas base (HP, Ataque, Defensa, Ataque Especial, Defensa Especial, Velocidad) y una habilidad de cada Pok√©mon al reporte CSV.
- Worker (Azure Function - Python):
  - Despu√©s de obtener la lista inicial de Pok√©mon para el tipo seleccionado, se itera sobre esa lista. ‚óã Para cada Pok√©mon en la lista, realiza una llamada adicional a la PokeAPI usando la URL espec√≠fica de ese Pok√©mon para obtener sus detalles completos. 
  - De la respuesta detallada de cada Pok√©mon, se extrae: Las estad√≠sticas base 
  - Se Maneja posibles errores si la llamada a la URL de un Pok√©mon espec√≠fico falla.
  - Se Modifico la funci√≥n que genera el CSV : ‚ñ† se A√±aden las nuevas columnas al DataFrame y al CSV para cada estad√≠stica base

## Muestreo :
Permite al usuario especificar un n√∫mero m√°ximo de registros aleatorios a incluir en el
reporte.
- Frontend (Next.js):
  - Se A√±adio un campo de entrada num√©rica en el formulario.
- Backend (API FastAPI):
  - Se Modific√≥ el endpoint de creaci√≥n para aceptar el nuevo par√°metro. Actualiza el modelo Pydantic
  - Almacena este valor en una nueva columna en la tabla de reportes en Azure SQL DB.
- Worker (Azure Function - Python):
  - Se Obtiene el sample size para el reporte que se est√° procesando.
  - Despu√©s de obtener la lista completa de resultados de la API externa (PokeAPI), si se especific√≥ un sample size v√°lido y menor al total de resultados, se usa random.sample() para seleccionar aleatoriamente los registros.
  - Se Genera el CSV usando la lista resultante.

### Desaf√≠os y Soluciones

Crear el ambiente de desarrollo: se debe tener mucho cuidado al seleccionar de manera correcta los paquetes que ser√°n utilizados en el ambiente en el cual se desee trabajar, verificar que sean compatibles entre versiones, y los lenguajes que se utilizar√°n.

Levantar los servicios para probar el proyecto de manera local: Tener presente todos los procesos que engloban este proyecto, como ser el Frontend con Next.js, el backend con Fast Api y utilizando Uvicorn, la function app instalando drivers y herramientas para poder levantar el servicio en Windows, evitar interferencia entre puertos, etc.

Dar seguimiento a la L√≥gica de la Solicitud: Debido a que el proyecto se encuentra muy bien estructurado y los m√©todos y funciones muchas veces se encuentran en archivos diferentes, y/o en carpetas diferentes, aunque ordenado se vuelve complejo dar seguiemiento al proceso de solicitud, por lo cual se debe ser ordenado al implementar nuevas funcionalidades e ir proyecto por proyecto, primero Frontend, luego Backend, etc. ampliando el uso de mensajes en las consolas para facilitar el debugging


# Enlaces
## Repositorios del Proyecto

- [FrontEnd](https://github.com/HerreraCruz/pkm.queue.ui.git)
- [BackEnd](https://github.com/HerreraCruz/pkm.queue.api.git)
- [Worker](https://github.com/HerreraCruz/pkm.queue.function.git)
- [Infraestructura](https://github.com/HerreraCruz/pkm.terraform.git)
- [Scripts BD](https://github.com/HerreraCruz/pkm.queue.sql.git)

## Aplicaci√≥n Desplegada

- [Pokequeue App](https://pokequeue-app.azurewebsites.net/)